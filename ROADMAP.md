# 1v1 감독 전술 시뮬레이터 — Roadmap

> Tech: **Rust + WASM + TypeScript (Web)**
> Scope: 11v11, 실시간 전술 조정(1v1), 결정론적 시뮬레이션, 리플레이/분석, 오프라인·온라인 지원

---

## 목표

* 사용자가 **실시간 전술**(슬라이더·프리셋·개인지시)을 조정하면, 엔진이 이를 **파생 파라미터→행동**으로 매 틱 반영한다.
* **결정론**(same input+seed → same outcome), **락스텝 네트코드**, **리플레이 완전재현**을 달성한다.
* 분석 툴(xG/PPDA/라인·폭 타임시리즈)과 세트피스 에디터까지 제공한다.

---

## Now (M0–M2) — 코어 안정화

### M0. 코어 루프·결정론·디버깅

* [x] 고정 `fixed_dt`(60Hz) + 렌더 보간 루프
* [ ] RNG 시드 고정 및 float 정규화(핵심 경로 fixed/f16 스냅)
* [ ] **스냅샷 v1**: `version|tick|ball|players[]` (전/후방 호환 규칙 문서화)
* [ ] **리플레이 v1**: `seed + input_ops`만 저장 (완전 재현)
* [ ] 디버그 오버레이: 라인/폭/압박반경, 네비 경로, 충돌 AABB
* [ ] 골든 리플레이 해시 비교(CI 스크립트)

### M1. 액션 셋(개인 스킬) 구축

* [ ] 볼 없는: 스프린트/침투·지연/마킹/커버/압박/조키
* [ ] 볼 소유: 패스(그라운드/스로우/크로스)/원투/드리블/슛/홀드업
* [ ] 수비: 인터셉트/스탠딩·슬라이딩 태클/몸싸움
* [ ] GK: 기본 세이브/펀칭·캐칭/빌드업(롤·킥)
* [ ] FSM + 유틸리티(소프트맥스/ε-greedy)로 행동 선택
* [x] 기본 액션 루프(드리블/패스/슛/태클) 및 WASM 커맨드 브리지 연결

### M2. 전술 파이프라인 v1

* [ ] 전술 스키마(멘탈리티/템포/폭/라인/엔게이지/압박/패스리스크…)
* [ ] 파생 파라미터 계산: 라인·폭·압박반경·쿨다운·스태미너 배수·지연
* [ ] 팀/개인 **Phase FSM**: `In / Transition / Out` (전환 오버라이드)
* [ ] 플레이북 2종: High Press Trap, Left Overlap (트리거·목표·종료)
* [ ] TS↔WASM 브리지: `set_tactics(op)` / `get_snapshot()` 적용

---

## Next (M3–M7) — 기능 확장·게임화

### M3. 경기 룰·심판·흐름

* [ ] 재시작: 킥오프/스로인/골킥/코너/프리킥
* [ ] 파울/어드밴티지/카드/오프사이드 엔진
* [ ] 전반/후반/추가시간, 일시정지/빠른진행, 교체 슬롯

### M4. 인지·공간·경로

* [ ] 영향지도 v1(격자): 우리/상대 도달시간, 위험/가치 히트맵
* [ ] 패스 평가식: 레인 개방도·수신각·거리·인터셉트 확률·후속 xG 근사
* [ ] 경로 탐색: navmesh 또는 균질그리드 + steering, spatial hash

### M5. 피지컬·컨디션

* [ ] 스태미너: 템포/압박 연동 소모, 저스태미너 페널티(가속/판단딜레이)
* [ ] 부상(옵션): 과격 태클/피로 누적, 경미/교체 필요 등급
* [ ] 환경(옵션): 날씨·피치 마찰/반발 보정

### M6. 전술·UI 확장

* [ ] 프리셋: 로우블록/미드블록/하이프레스/역습/지공 (핫키 1–5)
* [ ] 개인지시 라딜: "침투↑/넓게/타이트마킹/홀드업/컷인"
* [ ] HUD: PPDA, 압박성공률, 터치맵, 간이 xG/xT, 전술 변경 로그

### M7. 감독 AI/난이도

* [ ] 감독 AI: 점수·시간·스태미너 기반 전술 전환 스크립트
* [ ] 난이도: 반응 지연·리스크·플레이북 레퍼토리 차등
* [ ] 학습 훅(선택): 상태/보상 로그 내보내기(RL 연동)

---

## Later (M8–M11) — 멀티·분석·운영

### M8. 네트워킹(1v1)

* [ ] 락스텝: `TacticOp(tick=N+k)`만 동기, 결정론 로컬 재현
* [ ] 지연 보정: `k = ceil(RTT_ticks)+safety`, 틱 드리프트 감시
* [ ] 검증/안티치트: 호스트 룰·충돌 검증, 리플레이 합의 해시

### M9. 리플레이/분석 툴

* [ ] 플레이어블 리플레이: 프리/방송 카메라, 슬로모, 이벤트 점프
* [ ] 스카우트 뷰: 라인·간격·폭 타임시리즈, 압박 맵 애니메이션
* [ ] 세션 비교 대시보드: 전술 프리셋별 KPI(승률/xG/PPDA/턴오버 구역)

### M10. 에디터·콘텐츠 파이프라인

* [ ] 팀/선수 스키마(JSON, 버전드): 능력치/역할 프로파일
* [ ] 포메이션/플레이북 JSON 핫리로드, 검증기
* [ ] 모딩 포인트: 자산 폴더, 커스텀 플레이북 로딩

### M11. 품질·성능·출시 체크

* [ ] 성능 목표: 60Hz 시뮬/60FPS 렌더, 메인틱 ≤ 4ms(PC), WASM ≤ 64–128MB
* [ ] 프로파일링: hot path(선수×선수 O(N²) 회피), 공간분할
* [ ] 테스트: 골든 리플레이/룰 프로퍼티/경계값 퍼지/장시간 soak

---

## 12주 스프린트 플랜(샘플)

| 주차   | 마일스톤   | Exit 기준                          |
| ---- | ------ | -------------------------------- |
| W1–2 | M0, M1 | 동일 시드 리플레이 해시 일치, 패스/슛/드리블/태클 시연 |
| W3–4 | M2     | 하이프레스 vs 로우블록 A/B, 행동 분포 변화      |
| W5–6 | M3     | 오프사이드/파울/재시작 프로퍼티 테스트 통과         |
| W7–8 | M4–M5  | 템포·압박 ↔ 체력·성공률 상관 확인             |
| W9   | M6     | 프리셋 핫키/라딜 지시 실전 반영               |
| W10  | M7     | 무입력 경기 난이도 곡선 안정                 |
| W11  | M8     | 100경기 무 desync, 딜레이 설정 적용        |
| W12  | M9–M11 | 성능·안정성 기준 충족, 데모 빌드              |

---

## Definition of Done (도메인별)

* **전술 반영**: 슬라이더 변경 → **3틱 이내** 라인/폭/반경 오버레이 업데이트
* **결정론**: 동일 입력+시드 → 100경기 프레임 정확 리플레이 해시 일치
* **룰**: 오프사이드/파울/재시작/어드밴티지 프로퍼티 테스트 통과
* **성능**: 22명 경기 시뮬 틱 평균 ≤ 4ms, 99% 프레임 ≤ 8ms (PC)

---

## 리스크 & 대응

* 결정론 붕괴 → 핵심 수치 fixed-point/정규화, 골든 리플레이 CI
* O(N²) 병목 → 공간분할(그리드/쿼드트리), 유틸리티 후보 제한/캐시
* 룰 복잡성 → 최소 케이스→프로퍼티 테스트→커버리지 확장
* UI 피로 → 프리셋·추천 힌트(예: “PPDA 높음 → 라인 낮추기”)

---

## 작업 티켓 목록 (예시; GitHub Issue로 분해)

### Engine/Core

* [x] `fixed_dt` 고정 및 렌더 보간 파이프 구축
* [ ] RNG 시드/정규화 유틸(플랫폼 간 일관성)
* [x] Snapshot v1 직렬화/역직렬화 + 버전 헤더 추가
* [ ] Replay v1(입력·시드) + 해시 비교기
* [ ] 충돌 계층 정리(선수–선수 soft, 선수–볼 hard, 볼–골포스트)

### AI/Decision

* [ ] FSM 프레임(개인/팀) + 상태 전이 로깅
* [ ] 유틸리티 스코어 공통 라이브러리(웨이트 주입)
* [ ] 패스 평가 함수(레인/각/거리/차단/후속 xG)
* [ ] 압박/커버 스코어 + 영향지도 연동
* [ ] 마킹 할당(탐욕/헝가리안) + 히스테리시스
* [ ] 플레이북 실행기(트리거/목표/종료·쿨다운)

### Rules/Match

* [ ] 재시작 시나리오 엔진(킥오프/스로인/골킥/코너/프리킥)
* [ ] 파울/어드밴티지/카드 판정기
* [ ] 오프사이드 판정(패스 순간 기준)
* [ ] 경기 타임라인(전반/후반/추가시간/교체)

### Physics/Condition

* [ ] 스태미너 모델(템포·압박 연동) + 성능 영향
* [ ] 부상 시스템(옵션)
* [ ] 날씨/피치 파라미터(옵션)

### UI/HUD/Tools

* [ ] 전술 패널(슬라이더/프리셋/개인지시 라딜)
* [ ] 디버그 오버레이(라인/폭/압박반경/경로/AABB)
* [ ] KPI HUD(PPDA/xG/xT/터치맵/전술 로그)
* [ ] 세트피스 에디터 v1(코너/프리킥 플레이북)
* [ ] DevConsole(전술 주입·시나리오 스폰)
* [x] WASM 브리지: 60Hz 스냅샷/명령(패스·슛·전술 프리셋/토글) 연동

### Networking/Replay/Analytics

* [ ] 락스텝 프로토콜(`TacticOp(tick=N+k)`) 구현
* [ ] RTT 기반 k 산정, 틱 드리프트 감시
* [ ] 리플레이 뷰어(카메라/이벤트 점프/오버레이)
* [ ] 스카우트 뷰(라인·폭·간격 타임시리즈)
* [ ] Telemetry: 틱 시간/alloc/성공률 히스토그램

---

## 참고 구조(폴더 제안)

```
engine/        # Rust 코어(물리/룰/AI)
engine-wasm/   # WASM 바인딩, 스냅샷/커맨드 직렬화
web/           # TS/Three.js + 전술 UI/HUD
assets/        # 팀/선수/포메이션/플레이북 JSON
tools/         # 리플레이 뷰어/스카우트 뷰/검증 스크립트
.github/       # CI(골든 리플레이 해시 비교, 테스트)
```

---

## 이슈 템플릿 (복붙용)

```md
### 목적
(문제/가치)

### 완료 조건 (DoD)
- [ ]

### 상세 작업
- [ ]

### 리스크/노트
-
```
