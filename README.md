# FTO-AI 엔진 아키텍처 개요

이 문서는 현재까지 개발된 FTO AI 엔진의 핵심 아키텍처를 요약합니다.

## 핵심 철학: 인식 → 판단 → 행동

AI는 인간 선수처럼 주변 상황을 **인식**하고, 가장 유리한 행동을 **판단**하며, 결정된 행동을 **실행**하는 3단계 과정을 따릅니다.

### 1. 인식 (Perception) - `perception.rs`

AI가 세상을 보는 단계입니다. 매 순간 각 선수마다 `Perception`이라는 종합적인 데이터 구조를 생성합니다.

- **기본 정보**: 자신, 팀원, 상대 선수의 위치, 속도, 공의 상태 등
- **가공 정보**: 단순 위치 데이터뿐만 아니라, 판단에 직접적으로 도움이 되는 아래와 같은 정보들을 미리 계산합니다.
    - **골대까지의 거리 및 각도**: 슈팅의 유효성을 판단하는 기본 지표입니다.
    - **패스/슛 경로 개방도**: 상대 선수들의 위치를 기반으로 경로가 얼마나 안전한지 계산합니다. (Time-to-Intercept, TTI 알고리즘 사용)
    - **기대 위협(Expected Threat, xT)**: 특정 위치로 이동하거나 패스했을 때, 골을 넣을 확률이 얼마나 높아지는지를 나타내는 값입니다.

### 2. 판단 (Decision) - `fsm.rs`

인식된 정보를 바탕으로 어떤 행동을 할지 결정하는 단계로, 각 선수는 자신만의 **유한 상태 머신(Finite State Machine, FSM)**을 가집니다.

- **상태 관리**: 선수는 `Idle`(대기), `AttackShoot`(슈팅), `AttackPass`(패스) 등 명확한 상태 중 하나에만 존재합니다.
- **유틸리티 기반 판단**: `Idle` 상태일 때, AI는 `Perception` 데이터를 사용하여 가능한 모든 행동(슛, 패스, 드리블)의 '점수'를 계산합니다. (`score_shoot`, `score_pass` 등)
- **상태 전이**: 가장 높은 점수를 받은 행동을 선택하고, 그에 맞는 상태로 자신을 전환합니다. (예: `Idle` -> `AttackShoot`)

### 3. 행동 (Action) - `actions/` 디렉토리

판단 단계에서 결정된 행동을 실제로 수행하는 부분입니다. 각 액션은 독립적인 모듈로 분리되어 있습니다.

- **모듈화된 액션**: `ShootAction`, `PassAction` 등 각 행동의 로직은 모두 자신의 파일 안에 캡슐화되어 있습니다.
- **`begin` → `update` → `is_done` 패턴**:
    - `begin`: 액션이 시작될 때 호출되며, 엔진에 `Cmd::Shoot` 같은 초기 명령을 보냅니다.
    - `update`: 액션이 진행되는 동안 매 프레임 호출됩니다. (예: 슈팅 후 리바운드 준비)
    - `is_done`: 액션이 끝났는지 여부를 반환합니다. `true`가 되면 FSM은 다시 `Idle` 상태로 돌아가 새로운 판단을 시작합니다.

## 엔진과의 통합 - `engine.rs`

- `Engine`은 모든 선수의 FSM 인스턴스를 관리합니다.
- 매 틱마다 각 선수의 `fsm.tick()`을 호출하여 AI 로직 전체(인식, 판단, 행동)를 실행시킵니다.
- FSM이 반환하는 최종 명령(`Cmd`)을 받아 처리합니다.
